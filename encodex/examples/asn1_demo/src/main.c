/*
 *--------------------------------------
 * Program Name:
 * Author:
 * License:
 * Description:
 *--------------------------------------
*/

#include <stdint.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <stdio.h>
#include <encodex.h>
#define CEMU_CONSOLE ((char*)0xFB0000)

uint8_t asn1_demo[] = {0x30,0x81,0x9f,0x30,0x0d,0x06,0x09,0x2a,0x86,0x48,0x86,0xf7,0x0d,0x01,0x01,0x01,0x05,0x00,0x03,0x81,0x8d,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xb4,0x47,0xe7,0xff,0xaf,0x5a,0xd3,0x10,0x0b,0x64,0xea,0xe4,0xb0,0x30,0x99,0x6e,0x2f,0x91,0xfd,0x5c,0x2d,0x1e,0x58,0xfc,0x9f,0x0e,0x28,0x1f,0x25,0xec,0x6d,0x56,0x11,0x5a,0x3b,0xe9,0x24,0xfb,0xae,0xd9,0x24,0x13,0x5c,0x09,0x5f,0x8e,0x31,0x9f,0x8e,0x97,0x01,0x3a,0x57,0x12,0x07,0x57,0xf3,0x80,0xe0,0x33,0xb9,0x34,0x74,0xda,0x90,0x66,0x78,0x48,0x19,0x75,0x71,0x9b,0x10,0x99,0xfb,0x5a,0xfb,0xac,0x1c,0x68,0xdf,0xc5,0xc9,0x2a,0x35,0xa2,0x57,0xcf,0xe3,0x02,0xb6,0x1d,0x5a,0x91,0x80,0x80,0x54,0xce,0x8f,0x00,0x46,0x40,0x02,0xf2,0x5e,0x10,0xf6,0xe5,0xea,0x4b,0xd5,0x1d,0x4c,0x7c,0x57,0xbe,0x2c,0x80,0x61,0x47,0x4b,0x88,0xe6,0xda,0xa2,0x28,0x45,0xf9,0x02,0x03,0x01,0x00,0x01};


int main(void)
{
	asn1_obj_t output[10] = {0};
	asn1_obj_t output2[10] = {0};
	sprintf(CEMU_CONSOLE, "\n\n----------------------------------\nENCODEX ASN.1 Decoder Demo\n");

	// decode root node of asn1 data
	size_t obj_ct = asn1_decode(asn1_demo, sizeof asn1_demo, output, 10);
	sprintf(CEMU_CONSOLE, "Decode complete, %u objects parsed.\n", obj_ct);
	for(int i=0; i<obj_ct; i++)
		sprintf(CEMU_CONSOLE, "Obj %u, Tag Id: %u, Size: %u, Addr: %u\n", i, output[i].tag, output[i].len, output[i].data);
	
	obj_ct = asn1_decode(output[2].data, output[2].len, output2, 10);
	for(int i=0; i<obj_ct; i++)
		sprintf(CEMU_CONSOLE, "Obj %u, Tag Id: %u, Size: %u, Addr: %u\n", i, output2[i].tag, output2[i].len, output2[i].data);
	
    return 0;
}
